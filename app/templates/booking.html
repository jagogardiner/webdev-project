<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-, 101BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link href="../static/css/style.css" rel="stylesheet" />

    <title>{{ hotel.city }} - Booking - Horizon Hotels</title>
  </head>

  <body>
    <div id="header"></div>

    <main role="main">
      <div class="container">
        <div class="row row-cols-1 row-cols-xl-2">
          <div class="col mb-3">
            <div
              id="hotelOverview"
              class="carousel slide"
              data-bs-ride="carousel"
            >
              <div class="carousel-inner" role="listbox">
                <div class="carousel-ite, 10m active">
                  <img
                    src="../static/images/{{ hotel.city }}/image1.jpg"
                    class="d-block card-img-top-view img-fluid"
                    alt="..."
                  />
                </div>
                <div class="carousel-item">
                  <img
                    src="../static/images/{{ hotel.city }}/image2.jpg"
                    class="d-block card-img-top-view img-fluid"
                    alt="..."
                  />
                </div>
                <div class="carousel-item">
                  <img
                    src="../static/images/{{ hotel.city }}/image3.jpg"
                    class="d-block card-img-top-view img-fluid"
                    alt="..."
                  />
                </div>
              </div>
              <button
                class="carousel-control-prev"
                type="button"
                data-bs-target="#hotelOverview"
                data-bs-slide="prev"
              >
                <span
                  class="carousel-control-prev-icon"
                  aria-hidden="true"
                ></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button
                class="carousel-control-next"
                type="button"
                data-bs-target="#hotelOverview"
                data-bs-slide="next"
              >
                <span
                  class="carousel-control-next-icon"
                  aria-hidden="true"
                ></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          </div>
          <div class="col d-flex flex-column">
            <h3>{{ hotel.city }}</h3>
            <p>This is a generic hotel description.<br /></p>
            <form
              id="bookingForm"
              name="bookingForm"
              method="POST"
              role="form"
              action="/booking/{{ hotel.city }}"
            >
              <div class="input-group">
                <span class="input-group-text">Room type</span>
                <select
                  name="roomType"
                  id="roomType"
                  class="form-select"
                  aria-label="Room type"
                >
                  <option value="standard">Standard room</option>
                  <option value="double">Double room</option>
                  <option value="family">Family room</option>
                </select>
              </div>
              <div class="row mt-1 row-cols-1 row-cols-md-2 g-2">
                <div class="col">
                  <div class="input-group">
                    <span class="input-group-text">Booking start</span>
                    <input
                      type="date"
                      name="startDate"
                      class="form-control"
                      id="startDate"
                      name="trip-start"
                      min="2021-01-01"
                    />
                  </div>
                </div>
                <div class="col">
                  <div class="input-group">
                    <span class="input-group-text">Booking end</span>
                    <input
                      type="date"
                      name="endDate"
                      class="form-control"
                      id="endDate"
                      name="trip-end"
                      min="2021-01-01"
                    />
                  </div>
                </div>
              </div>
              <div class="input-group mt-2">
                <span class="input-group-text">Amount of guests</span>
                <!-- Default to 1 and disable as default room is 'standard' -->
                <select
                  id="guestAmount"
                  name="guestAmount"
                  class="form-select"
                  aria-label="Amount of guests"
                >
                  <option value="1">1</option>
                </select>
              </div>
              <input type="hidden" name="totalCost" id="totalCost" value="0" />
              <input
                type="hidden"
                name="transactionDate"
                id="transactionDate"
                value="0"
              />
            </form>
            <div class="text-bottom mt-auto mb-3">
              <p id="roomPricePerNight" class="h6"></p>
              <p id="roomPriceTotal" class="h6"></p>
              <p id="roomPriceDiscount" class="h6"></p>
              <p id="priceTotal" class="h4"></p>
              <button
                id="bookHotelBtn"
                class="btn mt-3 btn-primary w-100"
                form="bookingForm"
                type="submit"
              >
                Pay and book hotel
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- Modal -->
      <div
        class="modal fade"
        id="bookingSuccessModal"
        data-bs-backdrop="static"
        data-bs-keyboard="false"
        tabindex="-1"
        aria-labelledby="bookingSuccessModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="bookingSuccessModalTitle">
                Booking in progress.
              </h5>
            </div>
            <div class="modal-body"></div>
          </div>
        </div>
      </div>
    </main>

    <div id="footer"></div>

    <!-- jQuery CDN-->
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>

    <!-- Render header footer template -->
    <script src="../static/js/tools.js"></script>

    <!-- Booking site script -->
    <script src="../static/js/booking.js"></script>

    <!-- Bootstrap CDN -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <!-- Load header and footer -->
    <!-- Script to set date picker to today's date, and dynamically update end date minimum value. -->
    <!-- TODO: Refactor script -->
    <script>
      // eslint-disable-next-line no-undef
      loadTemplate()
      // Set event listener for form change - on change, recalculate prices.
      // Trigger the change event right away.
      $('#bookingForm')
        .on('change', () => {
          // eslint-disable-next-line no-undef
          const costs = calculateBookingCosts(
            // eslint-disable-next-line radix
            parseInt('{{ hotel.peakPrice }}'), // Peak price from Hotel class
            // eslint-disable-next-line radix
            parseInt('{{ hotel.offPeakPrice }}'), // Off peak price from Hotel class
            $('#startDate').val(), // Date from startDate date input
            $('#endDate').val(), // Date from endDate date input
            $('#roomType').val(),
            new Date(),
          ) // String from selected roomType input

          // Set all information from object "costs" returned from calculateBookingCosts
          if (costs.nights === 1) {
            $('#roomPriceTotal').text(
              costs.nights +
                ' night: £' +
                parseInt(costs.roomTotal, 10).toFixed(2),
            )
          } else {
            $('#roomPriceTotal').text(
              costs.nights +
                ' nights: £' +
                parseInt(costs.roomTotal, 10).toFixed(2),
            )
          }

          $('#roomPriceDiscount').text(
            'Advance booking discount: -£' + costs.discount.toFixed(2),
          )
          $('#roomPricePerNight').text(
            'Room price: £' + costs.pricePn.toFixed(2) + ' p/n',
          )
          $('#totalCost').val(parseInt(costs.beforePricePn.toFixed(), 10))
          $('#priceTotal').text(
            'Full total: £' + parseFloat(costs.totalCost).toFixed(2),
          )
        })
        .trigger('change')
    </script>
  </body>
</html>
